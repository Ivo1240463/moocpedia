@page "/course"
@using MOOCPediaApp.Models
@inject NavigationManager NavigationManager
@using MOOCPediaApp.Features.Course

<div class="course-container">
    <div class="course-top">
        <div class="video-section">
            @if (!string.IsNullOrEmpty(VideoSource))
            {
                <video controls autoplay class="course-video">
                    <source src="@VideoSource" type="video/mp4" />
                    Your browser does not support the video tag.
                </video>
            }
            else
            {
                <p class="no-video-selected">Please select a lesson to play its video.</p>
            }
        </div>

        <div class="lesson-picker">
            <CourseContentC TItem="CourseSection" Sections="CourseSections" LessonClicked="OnLessonClicked" />
        </div>
    </div>

    <div class="tabs">
        <button class="tab @(selectedTab == "Overview" ? "selected" : "")" @onclick="@(() => SelectTab("Overview"))">Overview</button>
        <button class="tab @(selectedTab == "Notes" ? "selected" : "")" @onclick="@(() => SelectTab("Notes"))">Notes</button>
        <button class="tab @(selectedTab == "Announcements" ? "selected" : "")" @onclick="@(() => SelectTab("Announcements"))">Announcements</button>
        <button class="tab @(selectedTab == "Reviews" ? "selected" : "")" @onclick="@(() => SelectTab("Reviews"))">Reviews</button>
        <button class="tab @(selectedTab == "Learning Tools" ? "selected" : "")" @onclick="@(() => SelectTab("Learning Tools"))">Learning Tools</button>
    </div>

    <div class="main-content">
        @if (selectedTab == "Overview")
        {
            <div>
                <div class="ratings">
                    <div class="rating-container">
                        <span class="rating-title">
                            <span class="rating-value">4.6</span>
                            <span class="rating-star">⭐</span>
                        </span>
                        <span class="rating-subtitle">325 ratings</span>
                    </div>
                    <div class="rating-container">
                        <span class="rating-title">565</span>
                        <span class="rating-subtitle">Students</span>
                    </div>
                    <div class="rating-container">
                        <span class="rating-title">4.2 hours</span>
                        <span class="rating-subtitle">Total</span>
                    </div>
                </div>
                <div class="course-description">
                    <p>
                        Ready to dive into the exciting world of solar energy?
                        This "comprehensive" and "in-depth" Photovoltaics course is designed to guide you through the science and technology of solar power...
                    </p>
                </div>
            </div>
        }
        else if (selectedTab == "Notes")
        {
            <div>
                <h3>Notes</h3>
                <p>Here are the course notes. Take notes while studying!</p>
            </div>
        }
        else if (selectedTab == "Announcements")
        {
            <div>
                <h3>Announcements</h3>
                <p>Check the latest updates about the course.</p>
            </div>
        }
        else if (selectedTab == "Reviews")
        {
            <div>
                <h3>Reviews</h3>
                <p>Read what others think about this course or leave a review yourself!</p>
            </div>
        }
        else if (selectedTab == "Learning Tools")
        {
            <div>
                <h3>Learning Tools</h3>
                <p>Explore tools that can help you better understand the material.</p>
            </div>
        }
    </div>
</div>

@code {
    private string selectedTab = "Overview";
    private string? VideoSource;

    protected override void OnInitialized()
    {
        var firstLesson = CourseSections.FirstOrDefault()?.Lessons?.FirstOrDefault();
        if (firstLesson != null)
        {
            VideoSource = firstLesson.VideoPath;
        }
    }

    private void SelectTab(string tab)
    {
        selectedTab = tab;
    }

    private void OnLessonClicked(Lesson lesson)
    {
        VideoSource = lesson.VideoPath;
    }

    private List<CourseSection> CourseSections = new()
    {
        new CourseSection
        {
            Title = "Section 1: Photovoltaics - Principles and Operation",
            Lessons = new List<Lesson>
            {
                new Lesson { Name = "Introduction", Duration = "1 min", VideoPath = "videos/introduction.mp4" },
                new Lesson { Name = "Principles of Solar Energy", Duration = "10 min", VideoPath = "videos/principles_of_solar_energy.mp4" }
            }
        },
        new CourseSection
        {
            Title = "Section 2: Inverters - Functionalities and Systems",
            Lessons = new List<Lesson>
            {
                new Lesson { Name = "Introduction", Duration = "1 min", VideoPath = "videos/inverters_introduction.mp4" },
                new Lesson { Name = "What are Inverters", Duration = "5 min", VideoPath = "videos/what_are_inverters.mp4" }
            }
        },
        new CourseSection
        {
            Title = "Section 3: Batteries - Types and Applications",
            Lessons = new List<Lesson>
            {
                new Lesson { Name = "Introduction to Batteries", Duration = "2 min", VideoPath = "videos/introduction_to_batteries.mp4" },
                new Lesson { Name = "Battery Technologies", Duration = "10 min", VideoPath = "videos/battery_technologies.mp4" }
            }
        }
    };
}
